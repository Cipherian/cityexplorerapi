"use strict";
const axios = require("axios");

class Movie {
  constructor(movie) {
    this.title = movie.title;
    this.overview = movie.overview;
    this.vote_average= movie.vote_average;
    this.vote_count = movie.vote_count;
    this.image_url = movie.poster_path;
    this.image_url = `https://image.tmdb.org/t/p/w300${movie.poster_path}`;
    this.popularity = movie.popularity;
    this.released_on = movie.release_date;
  }
}

async function getMovies(req, res, next) {
  const searchQuery = req.query.searchQuery;
  const url = `https://api.themoviedb.org/3/search/movie?api_key=${process.env.MOVIE_KEY}&query=${searchQuery}&language=en-US&page=1;`
  console.log(url);
  try {
    const response = await axios.get(url);
    console.log('testing', response.data.results);
    const movieArray = response.data.results.map(movie => new Movie(movie));
    console.log(movieArray);
    res.status(200).send(movieArray);
  } catch (error) {
    console.error(error)
    next(error.message);
  }
}

module.exports = getMovies;
