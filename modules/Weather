"use strict";
const axios = require("axios");

class Forecast {
  constructor(obj) {
    this.date = obj.datetime;
    this.description =
      "Low of " +
      obj.low_temp +
      ", High of " +
      obj.high_temp +
      " with " +
      obj.weather.description.toLowerCase();
  }
}

async function getWeather(req, res, next) {

  const { searchQuery, lat, lon } = req.query;
  let url = `https://api.weatherbit.io/v2.0/forecast/daily?days=7&units=I&lat=${lat}&lon=${lon}&city=${searchQuery}&key=${process.env.WEATHER_API_KEY}`;
  try {
    const weatherResponse = await axios.get(url);
    const weatherArray = weatherResponse.data.data.map(
      (forecast) => new Forecast(forecast)
    );
    res.send(weatherArray);
  } catch (error) {
    next(error.message);
  }
}

module.exports = getWeather;